{"version":3,"sources":["../../src/task/promise-event-emitter.js"],"names":["PromiseEventEmitter","event","listener","TypeError","fired","onceListener","removeListener","undefined","on","args","promises","listeners","forEach","push","all"],"mappings":"AAAA;AACA;;;;;;;;;AACA;;AACA;;;;;;;;;;;;IAEaA,mB,WAAAA,mB;;;;;;;;;;;6BACJC,K,EAAOC,Q,EAAU;AAAA;;AAClB,gBAAI,OAAOA,QAAP,KAAoB,UAAxB,EAAoC;AAChC,sBAAM,IAAIC,SAAJ,CAAc,6BAAd,CAAN;AACH;;AAED,gBAAIC,QAAQ,KAAZ;;AAEA,gBAAMC,eAAe,SAAfA,YAAe,GAAa;AAC9B,uBAAKC,cAAL,CAAoBL,KAApB,EAA2BI,YAA3B;;AAEA,oBAAID,UAAU,KAAd,EAAqB;AACjBA,4BAAQ,IAAR;AACA,2BAAOF,oCAAP;AACH;AACD,uBAAOK,SAAP;AACH,aARD;;AAUA;AACAF,yBAAaH,QAAb,GAAwBA,QAAxB;AACA,iBAAKM,EAAL,CAAQP,KAAR,EAAeI,YAAf;;AAEA,mBAAO,IAAP;AACH;;;6BAEIJ,K,EAAgB;AAAA,8CAANQ,IAAM;AAANA,oBAAM;AAAA;;AACjB,gBAAMC,WAAW,EAAjB;;AAEA,iBAAKC,SAAL,CAAeV,KAAf,EAAsBW,OAAtB,CAA8B,oBAAY;AACtCF,yBAASG,IAAT,CAAcX,0BAAYO,IAAZ,CAAd;AACH,aAFD;;AAIA,mBAAO,mBAAQK,GAAR,CAAYJ,QAAZ,CAAP;AACH","file":"promise-event-emitter.js","sourcesContent":["// MIT Â© 2017 azu\n\"use strict\";\nimport { EventEmitter } from \"events\";\nimport Promise from \"bluebird\";\n\nexport class PromiseEventEmitter extends EventEmitter {\n    once(event, listener) {\n        if (typeof listener !== \"function\") {\n            throw new TypeError(\"listener must be a function\");\n        }\n\n        let fired = false;\n\n        const onceListener = (...args) => {\n            this.removeListener(event, onceListener);\n\n            if (fired === false) {\n                fired = true;\n                return listener(...args);\n            }\n            return undefined;\n        };\n\n        // https://github.com/nodejs/node/blob/v4.1.2/lib/events.js#L286\n        onceListener.listener = listener;\n        this.on(event, onceListener);\n\n        return this;\n    }\n\n    emit(event, ...args) {\n        const promises = [];\n\n        this.listeners(event).forEach(listener => {\n            promises.push(listener(...args));\n        });\n\n        return Promise.all(promises);\n    }\n}\n"]}